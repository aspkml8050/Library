alter PROCEDURE [insert_BookCatalog_1]      
 (@ctrl_no_1  [bigint],      
  @catalogdate_2  [datetime],      
  @booktype_3  [int],      
  @volumenumber_4  [nvarchar](50),      
  @initpages_5  [nvarchar](8),      
  @pages_6  [int],      
  @parts_7  [nvarchar](50),      
  @leaves_8  [nvarchar](30),      
  @boundind_9  [nvarchar](50),      
  @title_10  [nvarchar](200),      
  @publishercode_11  [int],      
  @edition_12  [nvarchar](50),      
  @isbn_13  [nvarchar](50),      
  @subject1_14  [nvarchar](100),      
  @subject2_15  [nvarchar](100),      
  @subject3_16  [nvarchar](100),      
  @Booksize_17  [nvarchar](50),      
  @LCCN_18  [nvarchar](50),      
  @Volumepages_19  [nvarchar](20),      
  @biblioPages_20  [nvarchar](20),      
  @bookindex_21  [nvarchar](50),      
  @illustration_22  [nvarchar](50),      
  @variouspaging_23  [nvarchar](50),      
  @maps_24  [int],      
  @ETalEditor_25  [nvarchar](50),      
  @ETalCompiler_26  [nvarchar](50),      
  @ETalIllus_27  [nvarchar](50),      
  @ETalTrans_28  [nvarchar](50),      
  @ETalAuthor_29  [nvarchar](50),      
  @accmaterialhistory_31  [nvarchar](100),      
  @MaterialDesignation_32  [nvarchar](50),      
  @issn_33  [nvarchar](30),      
  @Volume_34  [nvarchar](50),      
  @dept_35  [int],      
  @language_id_36  [int],      
  @part_37  [nvarchar](25),      
  @eBookURL_38  [nvarchar](200),      
 @cat_Source_39[nvarchar](100),      
 @Identifier_40[nvarchar](30),      
 @firstname_41[nvarchar](100),      
 @percity_42[nvarchar](35),      
 @perstate_43[nvarchar](35),      
 @percountry_44[nvarchar](35),      
 @peraddress_45[nvarchar](200),      
 @departmentname_46[nvarchar](50),      
 @Btype_47[nvarchar](20),      
 @language_name_48[nvarchar](50),      
 @ItemCategory_49[nvarchar](40)  ,    
 @TransNo int    ,
 @ControlNo varchar(20)
)      
AS      
  if @ControlNo is null or trim(@ControlNo)=''
  begin
    select top 1 @ControlNo=ControlNo from Control008 where InUse=0 order by ControlNo
  end
  else
  begin
    if exists (select * from BookCatalog where ctrl_no<>@ctrl_no_1 and Control008=@ControlNo)
	begin;
	  declare @er varchar(45);
	  set @er='Control008 '+@ControlNo+' in use';
	  throw 50020,  @er ,1
	end;
  end 
if exists(select ctrl_no from bookcatalog where ctrl_no=@ctrl_no_1)      
begin      
 UPDATE [bookcatalog]       
SET  [catalogdate1]  = @catalogdate_2,      
  [booktype]  = @booktype_3,      
  [volumenumber]  = @volumenumber_4,      
  [initpages]  = @initpages_5,      
  [pages]  = @pages_6,      
  [parts]  = @parts_7,      
  [leaves]  = @leaves_8,      
  [boundind]  = @boundind_9,      
  [title]  = @title_10,      
  [publishercode]  = @publishercode_11,      
  [edition]  = @edition_12,      
  [isbn]  = @isbn_13,      
  [subject1]  = @subject1_14,      
  [subject2]  = @subject2_15,      
  [subject3]  = @subject3_16,      
  [Booksize]  = @Booksize_17,      
  [LCCN]  = @LCCN_18,      
  [Volumepages]  = @Volumepages_19,      
  [biblioPages]  = @biblioPages_20,      
  [bookindex]  = @bookindex_21,      
  [illustration]  = @illustration_22,      
  [variouspaging]  = @variouspaging_23,      
  [maps]  = @maps_24,      
  [ETalEditor]  = @ETalEditor_25,      
  [ETalCompiler]  = @ETalCompiler_26,      
  [ETalIllus]  = @ETalIllus_27,      
  [ETalTrans]  = @ETalTrans_28 ,      
 [ETalAuthor]=@ETalAuthor_29,      
  [accmaterialhistory]=@accmaterialhistory_31 ,      
      
[MaterialDesignation]=@MaterialDesignation_32,      
[issn]=@issn_33,      
[Volume]=@Volume_34,      
[dept]=@dept_35,      
[language_id]=@language_id_36,      
[part]=@part_37,      
[eBookURL]=@eBookURL_38,      
[cat_Source]=@cat_Source_39,      
[Identifier]=@Identifier_40,      
[firstname]=@firstname_41,      
[percity]=@percity_42,      
[perstate]=@perstate_43,      
[percountry]=@percountry_44,      
[peraddress]=@peraddress_45,      
[departmentname]=@departmentname_46,      
[Btype]=@Btype_47,      
[language_name]=@language_name_48,      
[ItemCategory]=@ItemCategory_49  ,    
TransNo=@TransNo    ,
Control008=@controlno      
      
WHERE       
 ( [ctrl_no]  = @ctrl_no_1)      
end       
else      
begin      
INSERT INTO [dbo].[BookCatalog]       
  ( [ctrl_no],      
  [catalogdate1],      
  [booktype],      
  [volumenumber],      
  [initpages],      
  [pages],      
  [parts],      
  [leaves],      
  [boundind],      
  [title],      
  [publishercode],      
  [edition],      
  [isbn],      
  [subject1],      
  [subject2],      
  [subject3],      
  [Booksize],      
  [LCCN],      
  [Volumepages],      
  [biblioPages],      
  [bookindex],      
  [illustration],      
  [variouspaging],      
  [maps],      
  [ETalEditor],      
  [ETalCompiler],      
  [ETalIllus],      
  [ETalTrans],      
  [ETalAuthor],      
  [accmaterialhistory],      
  [MaterialDesignation],      
  [issn],      
  [Volume],      
  [dept],      
  [language_id],      
  [part],      
  [eBookURL],      
 [cat_Source],      
 [Identifier],      
 [firstname],      
 [percity],      
 [perstate],      
 [percountry],      
 [peraddress],      
 [departmentname],      
 [Btype],      
 [language_name],      
 [ItemCategory]  ,TransNo  ,Control008  
)       
       
VALUES  ( @ctrl_no_1,      
  @catalogdate_2,      
  @booktype_3,      
  @volumenumber_4,      
  @initpages_5,      
  @pages_6,      
  @parts_7,      
  @leaves_8,      
  @boundind_9,      
  @title_10,      
  @publishercode_11,      
  @edition_12,      
  @isbn_13,      
  @subject1_14,      
  @subject2_15,      
  @subject3_16,      
  @Booksize_17,      
  @LCCN_18,      
  @Volumepages_19,      
  @biblioPages_20,      
  @bookindex_21,      
  @illustration_22,      
  @variouspaging_23,      
  @maps_24,      
  @ETalEditor_25,      
  @ETalCompiler_26,      
  @ETalIllus_27,      
  @ETalTrans_28,      
  @ETalAuthor_29,      
  @accmaterialhistory_31,      
  @MaterialDesignation_32,      
  @issn_33,      
  @Volume_34,      
  @dept_35,      
  @language_id_36,      
  @part_37,      
  @eBookURL_38,      
 @cat_Source_39,      
 @Identifier_40,      
 @firstname_41,      
 @percity_42,      
 @perstate_43,      
 @percountry_44,      
 @peraddress_45,      
 @departmentname_46,      
 @Btype_47,      
 @language_name_48,      
 @ItemCategory_49  ,@TransNo    ,@ControlNo
)  


end
update Control008 set InUse=1 where ControlNo=@ControlNo